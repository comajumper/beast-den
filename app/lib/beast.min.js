"use strict";!function(){function escapeDoubleQuotes(a){return a.replace(ReBackslash,"\\\\").replace(ReDoubleQuote,'\\"')}function escapeHtmlTags(a){return a.replace(ReLessThen,"&lt;").replace(ReMoreThen,"&gt;")}function camelCaseToDash(a){return a.replace(ReCamelCase,"$1-$2").toLowerCase()}function stringifyObject(a){if(Array.isArray(a)){for(var b="[",c=0,d=a.length;c<d;c++)b+=stringifyObject(a[c])+",";return b=b.slice(0,-1),b+="]"}if("object"==typeof a){var b="{";for(var e in a)void 0!==a[e]&&(b+='"'+e+'":'+stringifyObject(a[e])+",");return b=b.slice(0,-1),b+="}"}return"string"==typeof a?'"'+escapeDoubleQuotes(a)+'"':"function"==typeof a&&void 0!==a.beastDeclPath?a.beastDeclPath:a.toString()}function objectIsEmpty(a){for(var b in a)return!1;return!0}function cloneObject(a){if(Array.isArray(a)){for(var b=[],c=0,d=a.length;c<d;c++)b.push(cloneObject(a[c]));return b}if("object"==typeof a&&a){var e={};for(var f in a)e[f]=cloneObject(a[f]);return e}return a}function RequireModule(a){var b=new(XMLHttpRequest||ActiveXObject)("MSXML2.XMLHTTP.3.0");b.open("GET",a),b.onreadystatechange=function(){4===this.readyState&&200===this.status&&CheckIfBeastIsReady()},HttpRequestQueue.push(b),b.send()}function CheckIfBeastIsReady(){if(!BeastIsReady){for(var a=!0,b=0,c=HttpRequestQueue.length;b<c;b++){var d=HttpRequestQueue[b];4===d.readyState&&200===d.status||(a=!1)}if(document.styleSheets.length<CssLinksToLoad&&(a=!1),a){for(var b=0,c=HttpRequestQueue.length;b<c;b++)EvalBml(HttpRequestQueue[b].responseText);HttpRequestQueue=[],ProcessBmlScripts(),BeastIsReady=!0;for(var b=0,c=OnBeastReadyCallbacks.length;b<c;b++)OnBeastReadyCallbacks[b]()}}}function ProcessBmlScripts(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;b++){var d=a[b],e=d.text;"bml"===d.type&&""!==e&&EvalBml(e)}}function EvalBml(text){var parsedText=Beast.parseBML(text);/^[\s\n]*</.test(text)&&(parsedText+=document.body?".render(document.body)":".render(document.documentElement)"),eval(parsedText)}function CompileDeclarations(){function a(b,c){for(var d in c)2!==ReservedDeclarationProperies[d]&&(void 0===b[d]?b[d]=c[d]:"function"!=typeof c[d]||b[d]._inheritedDeclFunction?"object"!=typeof c[d]||Array.isArray(c[d])||a(b[d],c[d]):!function(a,b,c){a._inheritedDeclFunction=function(){var a=this._decl;this._decl=c,b.apply(this,arguments),this._decl=a}}(b[d],c[d],c))}function b(a,b,c){0!==b.length&&(c[a]=function(){for(var a=0,c=b.length;a<c;a++)b[a].call(this)})}function c(b,d,e){for(var f=d.length-1;f>=0;f--){var g=d[f],h=Declaration[g];void 0===e&&(e=[]),e.push(g),h&&(a(b,h),h.inherits&&c(b,h.inherits,e))}return e}for(var d in Declaration)(function(a){if(a.inherits){var d=c(a,a.inherits);a.__flattenInherits=d}var e=[];a.expand&&e.unshift(a.expand),a.param&&e.unshift(function(){this.defineParam(a.param)}),a.mod&&e.unshift(function(){this.defineMod(a.mod)}),a.mix&&e.unshift(function(){this.mix.apply(this,a.mix)}),a.tag&&e.unshift(function(){this.tag(a.tag)}),a.noElems&&e.unshift(function(){this.noElems()}),a.domAttr&&e.unshift(function(){this.domAttr(a.domAttr)}),a.onMod&&e.unshift(function(){for(var b in a.onMod)for(var c in a.onMod[b])this.onMod(b,c,a.onMod[b][c],!0)}),a.on&&e.unshift(function(){for(var b in a.on)this.on(b,a.on[b],!1,!0)}),a.onWin&&e.unshift(function(){for(var b in a.onWin)this.onWin(b,a.onWin[b],!1,!0)});var f=[];a.domInit&&f.unshift(a.domInit),b("__commonExpand",e,a),b("__commonDomInit",f,a),a.__userMethods={};for(var g in a)1!==ReservedDeclarationProperies[g]&&(a.__userMethods[g]=a[g])})(Declaration[d])}function ParseTextInsideBML(a){for(var e,b="",c=0,d="",f=0,g=a.length;f<g;f++)e=a[f],"{"===e&&"\\"!==d?(c++,1===c?""!==b&&(b+="',"):b+=e):c>0&&"}"===e?(c--,0===c?f<g-1&&"{"!==a[f+1]&&(b+=",'"):b+=e):0===c?(0===f&&(b+="'"),"'"===e&&(b+="\\"),b+=e,f===g-1&&(b+="'")):b+=e,d=e;return b}function ParseBMLNode(a,b,c){a=a.substr(1),a=a.substr(0,a.length-(b?2:1));var d=ParseNameAndAttrOfBMLNode(a);return c&&(d.attr+=(""===d.attr?"":",")+"'__context':this"),""===d.attr&&"undefined"===d.attr,"Beast.node('"+d.name+"',{"+d.attr+"}"+(b?")":"")}function ParseNameAndAttrOfBMLNode(a){for(var b,f,c="",d="",e="",g=!1,h=0,i=a.length-1;h<=i;h++){var j=a[h];h===i&&" "!==j&&"\n"!==j&&"'"!==j&&'"'!==j&&"="!==j&&(d+=j)," "!==j&&"\n"!==j&&h!==i||void 0!==b?" "!==j&&"\n"!==j&&h!==i||""===d||""!==e?"="===j&&""===e?(f=d,d=""):'"'!==j&&"'"!==j||""!==e?j!==e||g?" "!==j&&"\n"!==j||""===e?" "!==j&&"\n"!==j&&(d+=j):d+=j:(c+="'"+f+"':"+(""===d?"false":ParseTextInsideBML(d))+",",e="",d=""):e=j:(c+="'"+d+"':true,",d=""):(b=d,d=""),g="\\"===j}return""!==c&&(c=c.substring(0,c.length-1)),{name:b,attr:c}}function patchDomAttributes(a,b,c){var d=b._setDomNodeClasses(!0),e=c._setDomNodeClasses(!0);d!==e&&(a.className=d);for(var i,f=keysFromObjects(b._css,c._css),g=0,h=f.length;g<h;g++)i=f[g],void 0===b._css[i]?a.style[i]="":b._css[i]!==c._css[i]&&(a.style[i]=b._css[i]);for(var i,j=keysFromObjects(b._domAttr,c._domAttr),g=0,h=j.length;g<h;g++)i=j[g],void 0===b._domAttr[i]?a.removeAttribute(i):b._domAttr[i]!==c._domAttr[i]&&a.setAttribute(i,b._domAttr[i])}function patchDomEventHandlers(a,b,c){var d=b._selector!==c._selector;if(d||c._hasExpandContextEventHandlers||c._hasDomInitContextEventHandlers)for(var e in c._domNodeEventHandlers)for(var h,f=0,g=c._domNodeEventHandlers[e].length;f<g;f++)h=c._domNodeEventHandlers[e][f],(d||h.isExpandContext||h.isDomInitContext)&&a.removeEventListener(e,h);if(d||c._hasExpandContextWindowEventHandlers||c._hasDomInitContextWindowEventHandlers)for(var e in c._windowEventHandlers)for(var h,f=0,g=c._windowEventHandlers[e].length;f<g;f++)h=c._windowEventHandlers[e][f],(d||h.isExpandContext||h.isDomInitContext)&&window.removeEventListener(e,h);if(d||b._hasExpandContextEventHandlers)for(var e in b._domNodeEventHandlers)for(var h,f=0,g=b._domNodeEventHandlers[e].length;f<g;f++)h=b._domNodeEventHandlers[e][f],(d||h.isExpandContext)&&b.on(e,h,!0,!1,!0);if(d||b._hasExpandContextWindowEventHandlers)for(var e in b._windowEventHandlers)for(var h,f=0,g=b._windowEventHandlers[e].length;f<g;f++)h=b._windowEventHandlers[e][f],(d||h.isExpandContext)&&b.onWin(e,h,!0,!1,!0)}function keysFromObjects(){for(var a=[],b=0,c=arguments.length;b<c;b++)if(void 0!==arguments[b])for(var d in arguments[b])a.indexOf(d)===-1&&a.push(d);return a}function stringToHash(a){if(""===a)return"";for(var b=0,c=0,d=a.length;c<d;c++)b=(b<<5)-b+a.charCodeAt(c)|0;return b.toString()}"undefined"!=typeof window?("function"!=typeof window.CustomEvent&&(window.CustomEvent=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),window.Beast={},document.addEventListener("DOMContentLoaded",function(){Beast.init()})):(global.Beast={},module.exports=Beast);var Declaration={},DeclarationFinished=!1,HttpRequestQueue=[],CssLinksToLoad=0,BeastIsReady=!1,OnBeastReadyCallbacks=[],ReStartBML=/<[a-z][^>]+\/?>/i,ReDoubleQuote=/"/g,ReBackslash=/\\/g,ReLessThen=/</g,ReMoreThen=/>/g,ReCamelCase=/([a-z])([A-Z])/g,ReStylePairSplit=/:\s?/,ReservedDeclarationProperies={inherits:1,expand:1,mod:1,mix:1,param:1,domInit:1,domAttr:1,on:1,onWin:1,onMod:1,tag:1,noElems:1,state:1,abstract:2,__userMethods:2,__commonExpand:2,__commonDomInit:2,__flattenInherits:2},CssPxProperty={height:1,width:1,left:1,right:1,bottom:1,top:1,"line-height":1,"font-size":1},SingleTag={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1};Beast.declaration=Declaration,Beast.init=function(){for(var a=document.getElementsByTagName("link"),b=[],c=0,d=a.length;c<d;c++){var e=a[c];"bml"!==e.type&&"bml"!==e.rel||(RequireModule(e.href),b.push(e)),"stylesheet"===e.rel&&(CssLinksToLoad++,e.onload=e.onerror=function(){CheckIfBeastIsReady()})}for(var c=0,d=b.length;c<d;c++)b[c].parentNode.removeChild(b[c]);CheckIfBeastIsReady()},Beast.domInit=function(domNode,isInnerCall){if(void 0===domNode)return!1;if(1===domNode.nodeType){var className=domNode.className;if(className){var selector=className.split(" ")[0],indexOf__=selector.indexOf("__"),name;name=indexOf__===-1?selector[0].toUpperCase()+selector.substr(1):selector.substr(indexOf__+2);for(var bemNode=Beast.node(name),i=0,ii=domNode.attributes.length,name,value;i<ii;i++)if(name=domNode.attributes[i].name,value=domNode.attributes[i].value,"style"===name)for(var stylePairs=value.split(";"),j=0,jj=stylePairs.length,stylePair;j<jj;j++)stylePair=stylePairs[j].split(ReStylePairSplit),bemNode.css(stylePair[0],stylePair[1]);else"data-event-handlers"===name?eval("bemNode._domNodeEventHandlers = "+decodeURIComponent(value)):"data-mod-handlers"===name?eval("bemNode._modHandlers = "+decodeURIComponent(value)):"data-mod"===name?eval("bemNode._mod = "+decodeURIComponent(value)):"data-param"===name?eval("bemNode._param = "+decodeURIComponent(value)):"data-mix"===name?eval("bemNode._mix = "+decodeURIComponent(value)):"data-after-dom-init-handlers"===name?eval("bemNode._afterDomInitHandlers = "+decodeURIComponent(value)):"data-implemented-node-name"===name?bemNode._implementedNode=Beast.node(value):"class"!==name&&bemNode.domAttr(name,value);domNode.removeAttribute("data-event-handlers"),domNode.removeAttribute("data-mod-handlers"),domNode.removeAttribute("data-mod"),domNode.removeAttribute("data-param"),domNode.removeAttribute("data-mix"),domNode.removeAttribute("data-after-dom-init-handlers"),domNode.removeAttribute("data-implemented-node-name");for(var i=0,ii=domNode.childNodes.length,childNode;i<ii;i++)if(childNode=Beast.domInit(domNode.childNodes[i],!0),childNode instanceof BemNode){if(childNode._implementedNode){var childDomNode=childNode._domNode;childNode._domNode=void 0,bemNode.append(childNode._implementedNode),childNode._implementedNode.implementWith(childNode,!0),childNode._domNode=childDomNode}else bemNode.append(childNode);childNode._renderedOnce=!0}else bemNode.append(childNode);if(isInnerCall||(bemNode._renderedOnce=!0),bemNode._isExpanded=!0,bemNode._domNode=domNode,domNode.bemNode=bemNode,void 0!==bemNode._domNodeEventHandlers)for(var eventName in bemNode._domNodeEventHandlers)for(var i=0,ii=bemNode._domNodeEventHandlers[eventName].length;i<ii;i++)bemNode.on(eventName,bemNode._domNodeEventHandlers[eventName][i],!0,!1,!0);if(void 0!==bemNode._windowEventHandlers)for(var eventName in bemNode._windowEventHandlers)for(var i=0,ii=bemNode._windowEventHandlers[eventName].length;i<ii;i++)bemNode.onWin(eventName,bemNode._windowEventHandlers[eventName][i],!0,!1,!0);for(var name in bemNode._mod)bemNode._callModHandlers(name,bemNode._mod[name]);return bemNode._domInit(),bemNode}}else if(3===domNode.nodeType)return domNode.nodeValue;return!1},Beast.decl=function(a,b){if("object"==typeof a){for(var c in a)Beast.decl(c,a[c]);return this}if(a=a.toLowerCase(),"string"==typeof b.inherits&&(b.inherits=[b.inherits]),"string"==typeof b.mix&&(b.mix=[b.mix]),b.inherits)for(var d=0,e=b.inherits.length;d<e;d++)b.inherits[d]=b.inherits[d].toLowerCase();if(void 0!==Declaration[a]){var f=Declaration[a];for(var g in f)void 0===b[g]&&(b[g]=f[g])}return Declaration[a]=b,this},Beast.node=function(a,b){return DeclarationFinished||(DeclarationFinished=!0,CompileDeclarations()),new BemNode(a,b,Array.prototype.splice.call(arguments,2))},Beast.onReady=function(a){BeastIsReady?a():OnBeastReadyCallbacks.push(a)},Beast.parseBML=function(a){for(var b,c;;){if(b=a.indexOf("<!--"),b===-1)break;if(c=a.indexOf("-->"),c===-1)break;if(!(b<c))break;a=a.substr(0,b)+a.substr(c+3)}for(var d;;){if(d=ReStartBML.exec(a),null===d)return a;var g,e=d[0],f=d.index;if("/"===e[e.length-2])g=e.length;else{var h=e.indexOf("\n");h<0&&(h=e.indexOf(" ")),h<0&&(h=e.length-1);var o,p,i=e.substr(1,h-1),j=new RegExp("<"+i+"(?:|[ \n][^>]*)>","g"),k="</"+i+">",l=a.substr(f+1),m=-1,n=0,q=0;do g=0===q?l.search(k):p.search(k)+q,o=l.substr(0,g),p=l.substr(g+1),n=o.match(j),n=null!==n?n.length:0,m++,q=g+1;while(n>m);g+=1+k.length}for(var u,l=a.substr(f,g),r="",s="",t=[],v="",w=0,x=0,y=l.length;x<y;x++)u=l[x],"\n"!==u&&("{"===u&&"\\"!==v&&w++,"}"===u&&"\\"!==v&&w--,"<"===u&&0===w&&(t.push(s),s=""),s+=u,">"===u&&0===w&&(t.push(s),s=""),v=u);""!==s&&t.push(l);for(var A,z=!0,x=0,y=t.length;x<y;x++){var u=t[x];if(""!==u){var B=u.substr(0,1),C=u.substr(0,2),D=u.substr(u.length-1),E=u.substr(u.length-2);if("</"!==C||">"!==D)if(z?(z=!1,A=!0):(r+=", ",A=!1),"<"!==B||"/>"!==E)if("<"!==B||">"!==D){if("<"===B)return console.error("Unclosed node:",u);r+=ParseTextInsideBML(u)}else r+=ParseBMLNode(u,!1,A);else r+=ParseBMLNode(u,!0,A);else r+=")"}}a=a.substr(0,f)+r+a.substr(f+g)}},Beast.patchDom=function(a,b,c,d,e,f){if(void 0!==b||void 0!==c){if(void 0===d&&(d=0),void 0===e&&(e=0),void 0!==b&&void 0!==b._domNode){for(var g;b._domNode!==a.childNodes[d];)g=f._children[e],f._children.splice(e,1),f._children.push(g),a.appendChild("string"==typeof g?a.childNodes[d]:g._domNode);if(g=f._children[e],g._linkedWithHashGlobal)return patchDomAttributes(b._domNode,b,g),patchDomEventHandlers(b._domNode,b,g),void b._domInit();c=g}else{if(void 0===c||void 0!==c&&void 0!==c._linkedNewNode)return b instanceof BemNode?b.render():a.appendChild(document.createTextNode(b)),!0;if(void 0===b){for(var g;void 0!==a.childNodes[d];)g=f._children[e],g instanceof BemNode?g.remove():(f._children.splice(e,1),a.removeChild(a.childNodes[d]));return!1}if(typeof b!=typeof c||"string"==typeof b&&b!==c||b._tag!==c._tag)return void(b instanceof BemNode?(b.render(),void 0!==a.childNodes[d+1]&&a.removeChild(a.childNodes[d+1])):a.replaceChild(document.createTextNode(b),a.childNodes[d]))}if(b instanceof BemNode){b._domNode=c._domNode,b._domNode.bemNode=b,b._renderedOnce=!0,patchDomAttributes(b._domNode,b,c),patchDomEventHandlers(b._domNode,b,c);for(var h,i,j=b._children.length,k=c._children.length,l=0;l<j;l++)if(h=b._children[l],"string"!=typeof h)for(var m=0;m<k&&(i=c._children[m],"string"==typeof i||i._linkedWithHashGlobal||h._hashGlobal!==i._hashGlobal&&(h._hashLocal!==i._hashLocal||i._linkedWithHashLocal||void 0!==h._domNode)||(void 0!==i._linkedNewNode&&(i._linkedNewNode._domNode=void 0,i._linkedNewNode._renderedOnce=!1),h._domNode=i._domNode,h._domNode.bemNode=h,h._renderedOnce=!0,i._linkedNewNode=h,i._linkedWithHashGlobal=h._hashGlobal===i._hashGlobal,i._linkedWithHashLocal=!0,!i._linkedWithHashGlobal));m++);for(var o,l=0,n=0;(l<j||l<k+n)&&(o=Beast.patchDom(b._domNode,b._children[l],c._children[l-n],l,l-n,c),o!==!1);l++)o===!0&&n++;b._domInit()}}};var BemNode=function(a,b,c){this._selector="",this._nodeName=a,this._attr=b||{},this._isBlock=!1,this._isElem=!1,this._mod={},this._param={},this._state=void 0,this._domNode=void 0,this._domAttr={},this._domNodeEventHandlers=void 0,this._windowEventHandlers=void 0,this._modHandlers=void 0,this._afterDomInitHandlers=[],this._domInited=!1,this._parentBlock=void 0,this._parentNode=void 0,this._prevParentNode=void 0,this._children=[],this._expandedChildren=void 0,this._isExpanded=!1,this._isExpandContext=!1,this._isReplaceContext=!1,this._isRenderStateContext=!1,this._isDomInitContext=!1,this._mix=[],this._tag="div",this._noElems=!1,this._implementedNode=void 0,this._css={},this._cssClasses=void 0,this._decl=void 0,this._flattenInherits=void 0,this._flattenInheritsForDom=void 0,this._renderedOnce=!1,this._elems=[],this._hashGlobal="",this._hashLocal="",this._linkedNewNode=void 0;var d=a.substr(0,1);this._isBlock=d===d.toUpperCase(),this._isElem=!this._isBlock;for(var e in this._attr){var d=e.substr(0,1);"__context"===e?void 0===this._parentBlock&&this.parentBlock(this._attr.__context):d===d.toUpperCase()?this._mod[e.toLowerCase()]=this._attr[e]:"tag"===e?this._tag=this._attr.tag:this._param[e.toLowerCase()]=this._attr[e]}this._isBlock&&(this._parentBlock=this,this._defineDeclarationBySelector(a.toLowerCase())),this.append.apply(this,c)};BemNode.prototype={_defineDeclarationBySelector:function(a){if(this._selector=a,this._decl=Declaration[this._selector],this._flattenInherits=this._decl&&this._decl.__flattenInherits,this._decl&&this._decl.state&&(this._state=this._decl.state.call(this)),this._flattenInherits)for(var d,b=0,c=this._flattenInherits.length;b<c;b++)d=Declaration[this._flattenInherits[b]],d&&d.abstract||(void 0===this._flattenInheritsForDom&&(this._flattenInheritsForDom=[]),this._flattenInheritsForDom.push(this._flattenInherits[b]));this._defineUserMethods()},_defineUserMethods:function(a){var b=void 0!==a?Declaration[a]:this._decl;if(b)for(var c in b.__userMethods)this[c]=b.__userMethods[c]},_clearUserMethods:function(){if(""!==this._selector&&Declaration[this._selector]){var a=Declaration[this._selector].__userMethods;for(var b in a)this[b]=void 0}},inherited:function(a){return a&&void 0!==a._inheritedDeclFunction&&a._inheritedDeclFunction.apply(this,Array.prototype.splice.call(arguments,1)),this},isKindOf:function(a){a=a.toLowerCase();var b=this._selector===a;return!b&&this._flattenInherits&&(b=this._flattenInherits.indexOf(a)>-1),b},isBlock:function(){return this._isBlock},isElem:function(){return this._isElem},selector:function(){return this._selector},tag:function(a){return void 0===a?this._tag:(this._domNode||(this._tag=a),this)},css:function(a,b){if("object"==typeof a)for(var c in a)this.css(c,a[c]);else{if(void 0===b)return this._domNode?window.getComputedStyle(this._domNode).getPropertyValue(a):this._css[a];"number"==typeof b&&CssPxProperty[a]&&(b+="px"),this._css[a]=b,this._domNode&&this._setDomNodeCSS()}return this},noElems:function(){this._noElems=!0;for(var a=this._parentBlock._parentNode;a._noElems===!0;)a=a._parentBlock._parentNode;return this._setParentBlockForChildren(this,a),this},parentBlock:function(a,b){if(a){if(this._isElem&&a instanceof BemNode&&a!==this._parentBlock){if(a._parentBlock&&a._parentBlock._noElems)return this.parentBlock(a._parentNode,b);this._clearUserMethods(),this._removeFromParentBlockElems(),this._parentBlock=a._parentBlock,this._addToParentBlockElems(),this._defineDeclarationBySelector(this._parentBlock._selector+"__"+this._nodeName.toLowerCase()),b||this._setParentBlockForChildren(this,a)}return this}return this._implementedNode?this._implementedNode._parentBlock:this._parentBlock},_setParentBlockForChildren:function(a,b){for(var c=0,d=a._children.length;c<d;c++){var e=a._children[c];e instanceof BemNode&&e._isElem&&e.parentBlock(b)}},parentNode:function(a){return void 0!==a?(this._renderedOnce&&this.detach(),a!==this._parentNode&&(this._prevParentNode=this._parentNode,this._parentNode=a),this):this._parentNode},domNode:function(){return this._domNode},domAttr:function(a,b,c){if("object"==typeof a)for(var d in a)this.domAttr(d,a[d]);else{if(void 0===b)return void 0===this._domNode?this._domAttr[a]:this._domNode[a];c||(this._domAttr[a]=b),this._domNode&&(b===!1||""===b?this._domNode.removeAttribute(a):this._domNode.setAttribute(a,b))}return this},mix:function(){for(var a=0,b=arguments.length;a<b;a++)this._mix.push(arguments[a]);return this._domNode&&this._setDomNodeClasses(),this._cssClasses=void 0,this},defineMod:function(a){return this._implementedNode&&this._implementedNode._extendProperty("_mod",a),this._extendProperty("_mod",a)},_extendProperty:function(a,b){var d,c=this[a];for(var e in b)d=e.toLowerCase(),void 0!==c[d]&&""!==c[d]||(c[d]=b[e]);return this},defineParam:function(a){return this._extendProperty("_param",a)},mod:function(a,b,c){if(void 0===a)return this._mod;if("string"!=typeof a){for(var d in a)this.mod(d,a[d]);return this}return a=a.toLowerCase(),void 0===b?this._mod[a]:(this._mod[a]!==b&&(this._cssClasses=void 0,this._mod[a]=b,this._implementedNode&&(this._implementedNode._mod[a]=b),this._domNode&&(this._setDomNodeClasses(),this._callModHandlers(a,b,c))),this)},state:function(a,b,c){if(void 0===a)return this._state;if("string"!=typeof a){for(var d in a)this.state(d,a[d],!0);return this.renderState(),this}return a=a.toLowerCase(),void 0===b?this._state[a]:(this._state[a]!==b&&(this._isExpandContext?console.error("Change state in expand context is not allowed:",a,b):(this._state[a]=b,c||this.renderState())),this)},toggleMod:function(a,b,c){return this.mod(a)&&this.mod(a)!==c?this.mod(a,c):this.mod(a,b),this},param:function(a,b){if(void 0===a)return this._param;if("string"!=typeof a){for(var c in a)this.param(c,a[c]);return this}return a=a.toLowerCase(),void 0===b?this._param[a]:(this._param[a]=b,this)},on:function(a,b,c,d,e){if("function"!=typeof b)return this;if(!b.isBoundToNode){var f=b;b=function(a){f.call(this,a,a.detail)}.bind(this),b.isBoundToNode=!0}if(!c&&a.indexOf(" ")>-1)for(var g=a.split(" "),h=0,i=g.length;h<i;h++)this.on(g[h],b,!0);else void 0!==this._domNode&&this._domNode.addEventListener(a,b),e||(void 0===this._domNodeEventHandlers&&(this._domNodeEventHandlers={}),void 0===this._domNodeEventHandlers[a]&&(this._domNodeEventHandlers[a]=[]),this._domNodeEventHandlers[a].push(b)),this._isExpandContext&&!d&&(b.isExpandContext=!0,this._hasExpandContextEventHandlers=!0),this._isDomInitContext&&(b.isDomInitContext=!0,this._hasDomInitContextEventHandlers=!0);return this},onWin:function(a,b,c,d,e){if("function"!=typeof b)return this;if(!b.isBoundToNode){var f=b;b=function(a){f.call(this,a,a.detail)}.bind(this),b.isBoundToNode=!0}if(!c&&a.indexOf(" ")>-1)for(var g=a.split(" "),h=0,i=g.length;h<i;h++)this.onWin(g[h],b,!0);else void 0!==this._domNode&&window.addEventListener(a,b),e||(void 0===this._windowEventHandlers&&(this._windowEventHandlers={}),void 0===this._windowEventHandlers[a]&&(this._windowEventHandlers[a]=[]),this._windowEventHandlers[a].push(b)),this._isExpandContext&&!d&&(b.isExpandContext=!0,this._hasExpandContextWindowEventHandlers=!0),this._isDomInitContext&&(b.isDomInitContext=!0,this._hasDomInitContextWindowEventHandlers=!0);return this},onMod:function(a,b,c,d){return this._isExpandContext&&!d&&(c.isExpandContext=!0,this._hasExpandContextModHandlers=!0),d&&(c.beastDeclPath='Beast.declaration["'+this._selector+'"].onMod["'+a+'"]["'+b+'"]'),a=a.toLowerCase(),void 0===this._modHandlers&&(this._modHandlers={}),void 0===this._modHandlers[a]&&(this._modHandlers[a]={}),void 0===this._modHandlers[a][b]&&(this._modHandlers[a][b]=[]),this._modHandlers[a][b].push(c),this},trigger:function(a,b){return this._domNode&&this._domNode.dispatchEvent(b?new CustomEvent(a,{detail:b}):new Event(a)),this},triggerWin:function(a,b){return this._domNode&&(a=this.parentBlock()._nodeName+":"+a,window.dispatchEvent(b?new CustomEvent(a,{detail:b}):new Event(a))),this},index:function(a){for(var b=this._parentNode._children,c=0,d=0,e=b.length;d<e;d++)if("string"==typeof b[d]&&c++,b[d]===this)return a?d:d-c},empty:function(){var a;if(this._isExpandContext?(a=this._expandedChildren,this._expandedChildren=[]):(a=this._children,this._children=[]),a)for(var b=0,c=a.length;b<c;b++)a[b]instanceof BemNode&&a[b].remove();if(this._domNode)for(;this._domNode.firstChild;)this._domNode.removeChild(this._domNode.firstChild);return this},_removeFromParentBlockElems:function(){var a;if(this._isElem?a=this._parentBlock:this._isBlock&&this._implementedNode&&(a=this._implementedNode._parentBlock),a)for(var b=0,c=this._parentBlock._elems.length;b<c;b++)if(this._parentBlock._elems[b]===this){this._parentBlock._elems.splice(b,1);break}},_addToParentBlockElems:function(){var a;this._isElem?a=this._parentBlock:this._isBlock&&this._implementedNode&&(a=this._implementedNode._parentBlock),a&&a._elems.push(this)},remove:function(){for(var a=0,b=this._children.length;a<b;a++)this._children[a]instanceof BemNode&&(this._children[a].remove(),a--);if(void 0!==this._windowEventHandlers)for(var c in this._windowEventHandlers)for(var a=0,b=this._windowEventHandlers[c].length;a<b;a++)window.removeEventListener(c,this._windowEventHandlers[c][a]);this.detach()},detach:function(){return this._domNode&&this._domNode.parentNode&&this._domNode.parentNode.removeChild(this._domNode),this._parentNode&&(this._parentNode._children.splice(this._parentNode._children.indexOf(this),1),this._parentNode=void 0),this._removeFromParentBlockElems(),this},insertChild:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e!==!1&&null!==e&&void 0!==e)if(Array.isArray(e))this.insertChild(e,b);else{e instanceof BemNode?(e.parentNode(this),e._isElem&&(this._isBlock?e.parentBlock(this):void 0!==this._parentBlock&&e.parentBlock(this._parentBlock))):"number"==typeof e&&(e=e.toString());var f=this._children;this._isExpandContext&&(void 0===this._expandedChildren&&(this._expandedChildren=[]),f=this._expandedChildren),0===b?f.unshift(e):b===-1?f.push(e):f.splice(b,0,e),this._domNode&&!this._isReplaceContext&&this._renderChildWithIndex(b===-1?f.length-1:b)}}return this},append:function(){return this.insertChild(arguments,-1)},prepend:function(){return this.insertChild(arguments,0)},appendTo:function(a){return a.append(this),this},prependTo:function(a){return a.prepend(this),this},replaceWith:function(a,b){this._completeExpand();var d,c=this._parentNode;c&&(c===a?c=this._prevParentNode:(d=c._children.splice(this.index(!0)),d.shift()),c._isReplaceContext=!0,c.append(a),c._isReplaceContext=!1),d&&(c._children=c._children.concat(d)),this._parentNode=void 0,a instanceof BemNode&&(a._isBlock&&a._resetParentBlockForChildren(),this._isRenderStateContext?a._expandForRenderState(!0):b||a.render())},_resetParentBlockForChildren:function(){for(var a=0,b=this._children.length;a<b;a++){var c=this._children[a];c instanceof BemNode&&c._isElem&&(c.parentBlock(this._parentBlock),c._resetParentBlockForChildren(this._parentBlock))}},implementWith:function(a,b){this._cssClasses=void 0,void 0!==this._domNodeEventHandlers&&(a._domNodeEventHandlers=void 0===a._domNodeEventHandlers?this._domNodeEventHandlers:a._domNodeEventHandlers.concat(this._domNodeEventHandlers)),void 0!==this._windowEventHandlers&&(a._windowEventHandlers=void 0===a._windowEventHandlers?this._windowEventHandlers:a._windowEventHandlers.concat(this._windowEventHandlers)),this._setDomNodeClasses(),a._implementedNode=this,this._implementedWith=a,a._extendProperty("_mod",this._mod),a._extendProperty("_param",this._param),this._extendProperty("_mod",a._mod),a._defineUserMethods(this._selector),this.replaceWith(a,b),this._removeFromParentBlockElems(),a._addToParentBlockElems()},text:function(){for(var a="",b=0,c=this._children.length;b<c;b++)"string"==typeof this._children[b]&&(a+=this._children[b]);return a},elem:function(){if(this._isElem)return this.elem.apply(this._parentBlock,arguments);if(0===arguments.length)return this._elems;for(var d,a=[],b=0,c=this._elems.length;b<c;b++){d=this._elems[b];for(var g,e=0,f=arguments.length;e<f;e++)g=arguments[e].toLowerCase(),(d._nodeName===g||d._implementedNode&&d._implementedNode._nodeName===g)&&a.push(d)}return a},get:function(){if(0===arguments.length)return this._children;for(var d,a=[],b=0,c=arguments.length;b<c;b++){if("/"===arguments[b])d=this._filterChildNodes("");else for(var e=arguments[b].split("/"),f=0,g=e.length;f<g;f++){var h=e[f];if(0===f)d=this._filterChildNodes(h);else{var i=d;d=[];for(var j=0,k=i.length;j<k;j++)d=d.concat(this._filterChildNodes.call(i[j],h))}if(0===d.length)break}a=1===c?d:a.concat(d)}return a},_filterChildNodes:function(a){if(".."===a)return[this._parentNode];for(var b=[],c=0,d=this._children.length;c<d;c++){var e=this._children[c];e instanceof BemNode&&(""===a||a===e._nodeName||e._implementedNode&&a===e._implementedNode._nodeName)&&b.push(e)}return b},has:function(){return this.get.apply(this,arguments).length>0},afterDomInit:function(a){return this._domInited?a.call(this):this._afterDomInitHandlers.push(a),this},clone:function(a){var b={};b.__proto__=this.__proto__;for(var c in this)if("_children"===c){for(var d=[],e=0,f=this._children.length;e<f;e++)d.push(this._children[e]instanceof BemNode?this._children[e].clone(b):this._children[e]);b._children=d}else b[c]=this[c];return void 0!==a&&(b._parentNode=a),b},render:function(a){if(!this._isExpanded&&this._decl&&this._decl.__commonExpand&&(this._isExpandContext=!0,this._decl.__commonExpand.call(this),this._completeExpand(),this._isExpandContext=!1),!a&&!this._parentNode)return this;if(!this._domNode){this._domNode=document.createElement(this._tag),this._domNode.bemNode=this,this._setDomNodeClasses(),this._setDomNodeCSS();for(var b in this._domAttr)this.domAttr(b,this._domAttr[b],!0)}if(a?a.appendChild(this._domNode):this._parentNode._domNode.insertBefore(this._domNode,this._parentNode._domNode.childNodes[this.index(!0)]||null),!this._renderedOnce){for(var c=0,d=this._children.length;c<d;c++)this._renderChildWithIndex(c);if("body"===this._tag&&document.documentElement.replaceChild(this._domNode,document.body),void 0!==this._domNodeEventHandlers)for(var e in this._domNodeEventHandlers)for(var c=0,d=this._domNodeEventHandlers[e].length;c<d;c++)this.on(e,this._domNodeEventHandlers[e][c],!0,!1,!0);if(void 0!==this._windowEventHandlers)for(var e in this._windowEventHandlers)for(var c=0,d=this._windowEventHandlers[e].length;c<d;c++)this.onWin(e,this._windowEventHandlers[e][c],!0,!1,!0);for(var f in this._mod)this._callModHandlers(f,this._mod[f]);this._domInit(),this._renderedOnce=!0}return this},_renderChildWithIndex:function(a){var b=this._children[a];b instanceof BemNode?b.render():this._domNode.insertBefore(document.createTextNode(b),this._domNode.childNodes[a]||null)},_completeExpand:function(){this._isExpandContext&&this._expandedChildren&&(this._children=this._expandedChildren,this._expandedChildren=void 0),this._isExpanded=!0},_updateHash:function(){var a=this._tag+' class="'+this._setDomNodeClasses(!0)+'"';for(var b in this._domAttr)a+=" "+b+'="'+this._domAttr[b]+'"';for(var c in this._css)a+=" "+c+":"+this._css[c];this._hashLocal=stringToHash(a);for(var d=0,e=this._children.length;d<e;d++)"string"==typeof this._children[d]?a+=this._children[d]:(this._children[d]._updateHash(),a+=this._children[d]._hashGlobal);this._hashGlobal=stringToHash(a)},_domInit:function(){this._isDomInitContext=!0;var a=this._decl;if(a&&a.__commonDomInit&&a.__commonDomInit.call(this),this._implementedNode&&(a=this._implementedNode._decl)&&a.__commonDomInit&&a.__commonDomInit.call(this),this._isDomInitContext=!1,this._domInited=!0,0!==this._afterDomInitHandlers.length)for(var b=0,c=this._afterDomInitHandlers.length;b<c;b++)this._afterDomInitHandlers[b].call(this)},_callModHandlers:function(a,b,c,d){var e;if(void 0!==this._modHandlers&&this._modHandlers[a]&&(this._modHandlers[a][b]?e=this._modHandlers[a][b]:b===!1&&this._modHandlers[a][""]?e=this._modHandlers[a][""]:""===b&&this._modHandlers[a][!1]&&(e=this._modHandlers[a][!1]),this._modHandlers[a]["*"]&&(e=e?e.concat(this._modHandlers[a]["*"]):this._modHandlers[a]["*"])),e){void 0===d&&(d=this);for(var f=0,g=e.length;f<g;f++)e[f].call(d,c)}this._implementedNode&&this._implementedNode._callModHandlers(a,b,c,this)},_setDomNodeClasses:function(a){if(void 0===this._cssClasses){var c,d,b=this._selector;if(this._flattenInheritsForDom)for(var e=0,f=this._flattenInheritsForDom.length;e<f;e++)b+=" "+this._flattenInheritsForDom[e];if(0!==this._mix.length)for(var e=0,f=this._mix.length;e<f;e++)b+=" "+this._mix[e];for(var g in this._mod)if(c=this._mod[g],""!==c&&c!==!1&&(d=c===!0?"_"+g:"_"+g+"_"+c,b+=" "+this._selector+d,this._flattenInheritsForDom))for(var e=0,f=this._flattenInheritsForDom.length;e<f;e++)b+=" "+this._flattenInheritsForDom[e]+d;this._implementedNode&&(b+=" "+this._implementedNode._setDomNodeClasses(!0)),this._cssClasses=b}return a?this._cssClasses:void(this._domNode&&(this._domNode.className=this._cssClasses))},_setDomNodeCSS:function(){for(var a in this._css)(this._css[a]||0===this._css[a])&&(this._domNode.style[a]=this._css[a],window.getComputedStyle(this._domNode)[a])},toStringOfFunctions:function(){var a="{";for(var b in this._mod)a+='"'+(b.substr(0,1).toUpperCase()+b.slice(1))+'":',a+="string"==typeof this._mod[b]?'"'+this._mod[b]+'",':this._mod[b]+",";for(var b in this._param)"string"!=typeof this._param[b]&&"number"!=typeof this._param[b]||(a+='"'+b+'":"'+this._param[b]+'",');
a+="}";for(var c="",d=0,e=this._children.length;d<e;d++)c+=this._children[d]instanceof BemNode?this._children[d].toStringOfFunctions():'"'+escapeDoubleQuotes(this._children[d].toString())+'"',d<e-1&&(c+=",");return'Beast.node("'+this._nodeName+'",'+("{}"===a?"undefined":a)+(c?","+c+")":")")},toHtml:function(){!this._isExpanded&&this._decl&&this._decl.__commonExpand&&(this._isExpandContext=!0,this._decl.__commonExpand.call(this),this._completeExpand(),this._isExpandContext=!1);var a="";for(var b in this._domAttr)a+=" "+b+'="'+escapeDoubleQuotes(this._domAttr[b].toString())+'"';a+=' class="'+this._setDomNodeClasses(!0)+'"';var c="";for(var b in this._css)(this._css[b]||0===this._css[b])&&(c+=camelCaseToDash(b)+":"+escapeDoubleQuotes(this._css[b])+";");if(""!==c&&(a+=' style="'+c+'"'),this._domNodeEventHandlers&&(a+=' data-event-handlers="'+encodeURIComponent(stringifyObject(this._domNodeEventHandlers))+'"'),this._modHandlers&&(a+=' data-mod-handlers="'+encodeURIComponent(stringifyObject(this._modHandlers))+'"'),objectIsEmpty(this._mod)||(a+=' data-mod="'+encodeURIComponent(stringifyObject(this._mod))+'"'),objectIsEmpty(this._param)||(a+=' data-param="'+encodeURIComponent(stringifyObject(this._param))+'"'),0!==this._mix.length&&(a+=' data-mix="'+encodeURIComponent(stringifyObject(this._mix))+'"'),0!==this._afterDomInitHandlers.length&&(a+=' data-after-dom-init-handlers="'+encodeURIComponent(stringifyObject(this._afterDomInitHandlers))+'"'),void 0!==this._implementedNode&&(a+=' data-implemented-node-name="'+this._implementedNode._nodeName+'"'),1===SingleTag[this._tag])return"<"+this._tag+a+"/>";for(var d="",e=0,f=this._children.length;e<f;e++)d+=this._children[e]instanceof BemNode?this._children[e].toHtml():escapeHtmlTags(this._children[e].toString());return"<"+this._tag+a+">"+d+"</"+this._tag+">"},expand:function(){this.empty(),this._isReplaceContext=!0,this.append.apply(this,arguments),this._decl&&this._decl.expand&&(this._isExpandContext=!0,this._decl.expand.call(this),this._completeExpand(),this._isExpandContext=!1),this._isReplaceContext=!1;for(var a=0,b=this._children.length;a<b;a++)this._renderChildWithIndex(a);return this._decl&&this._decl.domInit&&this._decl.domInit.call(this),this._implementedNode&&this._implementedNode._decl&&this._implementedNode._decl.domInit&&this._implementedNode._decl.domInit.call(this),this},renderState:function(){var a={};a.__proto__=this.__proto__;for(var b in this)"_css"===b||"_domAttr"===b||"_mod"===b||"_modHandlers"===b||"_domNodeEventHandlers"===b||"_windowEventHandlers"===b?a[b]=cloneObject(this[b]):a[b]=this[b];for(var b=0,c=a._children.length;b<c;b++)a._children[b]instanceof BemNode&&(a._children[b]._parentNode=a);if(void 0!==this._modHandlers)for(var d in this._modHandlers)for(var e in this._modHandlers[d])for(var b=0,c=this._modHandlers[d][e].length;b<c;b++)this._modHandlers[d][e][b].isExpandContext&&(this._modHandlers[d][e].splice(b,1),b--,c--);if(void 0!==this._domNodeEventHandlers)for(var f in this._domNodeEventHandlers)for(var b=0,c=this._domNodeEventHandlers[f].length;b<c;b++)this._domNodeEventHandlers[f][b].isExpandContext&&(void 0!==this._domNode&&this._domNode.removeEventListener(f,this._domNodeEventHandlers[f][b]),this._domNodeEventHandlers[f].splice(b,1),b--,c--);if(void 0!==this._windowEventHandlers)for(var f in this._windowEventHandlers)for(var b=0,c=this._windowEventHandlers[f].length;b<c;b++)this._windowEventHandlers[f][b].isExpandContext&&(window.removeEventListener(f,this._windowEventHandlers[f][b]),this._windowEventHandlers[f].splice(b,1),b--,c--);this._domNode=void 0,this._children=[],this._elems=[],this._implementedNode=void 0,this._isExpanded=!1,this._hasExpandContextEventHandlers=!1,this._hasExpandContextWindowEventHandlers=!1,this._hasExpandContextModHandlers=!1,this._hasDomInitContextWindowEventHandlers=!1,this._renderedOnce=!1,this._expandForRenderState(),this._updateHash(),a._updateHash(),Beast.patchDom(a._domNode.parentNode,this,a),this._domInit(!0),this.trigger("DidRenderState")},_expandForRenderState:function(a){if(this._isRenderStateContext=!0,this._decl&&(this._decl.expand||this._decl.__commonExpand)&&(this._isExpandContext=!0,a?this._decl.__commonExpand.call(this):this._decl.expand.call(this),this._completeExpand(),this._isExpandContext=!1),void 0!==this._parentNode)for(var b=0,c=this._children.length;b<c;b++)this._children[b]instanceof BemNode&&this._children[b]._expandForRenderState(!0);this._isRenderStateContext=!1}}}();
